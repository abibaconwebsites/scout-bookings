<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Scout Bookings Settings - Manage your account and preferences">
  <title>Settings - Scout Bookings</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    /* Settings Layout */
    .settings-layout {
      display: flex;
      min-height: calc(100vh - 73px);
    }

    /* Sidebar */
    #settings-sidebar {
      width: 200px;
      flex-shrink: 0;
      background-color: var(--color-white);
      border-right: 1px solid var(--color-border);
      padding: 1.5rem 0.75rem;
      position: sticky;
      top: 73px;
      height: calc(100vh - 73px);
      overflow-y: auto;
    }

    .sidebar-title {
      font-size: 0.6875rem;
      font-weight: 600;
      color: var(--color-placeholder);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0 0.75rem;
      margin-bottom: 0.75rem;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }

    .sidebar-nav-item {
      display: block;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      color: var(--color-text);
      font-weight: 500;
      transition: all var(--transition-fast);
      border: none;
      background: none;
      text-align: left;
      width: 100%;
      font-size: 0.875rem;
    }

    .sidebar-nav-item:hover {
      background-color: var(--color-background);
    }

    .sidebar-nav-item.active {
      background-color: var(--color-primary);
      color: var(--color-white);
    }

    /* Main Content */
    #settings-content {
      flex: 1;
      padding: 2rem;
      min-height: calc(100vh - 73px);
      background-color: var(--color-background);
    }

    .settings-panel {
      display: none;
      max-width: 800px;
    }

    .settings-panel.active {
      display: block;
    }

    .panel-header {
      margin-bottom: 2rem;
    }

    .panel-header h1 {
      font-size: 1.75rem;
      margin-bottom: 0.5rem;
    }

    .panel-header p {
      color: var(--color-placeholder);
      margin: 0;
    }

    /* Settings Cards */
    .settings-card {
      background-color: var(--color-white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .settings-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .settings-card-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0;
    }

    .settings-card-subtitle {
      font-size: 0.875rem;
      color: var(--color-placeholder);
      margin-top: 0.25rem;
    }

    /* Connection Status */
    .connection-status {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      background-color: var(--color-background);
      border-radius: var(--radius-md);
      margin-bottom: 1rem;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-indicator.connected {
      background-color: var(--color-success);
    }

    .status-indicator.disconnected {
      background-color: var(--color-placeholder);
    }

    .status-text {
      flex: 1;
    }

    .status-text-main {
      font-weight: 500;
      color: var(--color-text);
    }

    .status-text-sub {
      font-size: 0.875rem;
      color: var(--color-placeholder);
    }

    /* Help Text */
    .help-text {
      font-size: 0.875rem;
      color: var(--color-placeholder);
      margin-top: 0.5rem;
    }

    /* Toggle Switch */
    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      border-bottom: 1px solid var(--color-border);
    }

    .toggle-row:last-child {
      border-bottom: none;
    }

    .toggle-label {
      flex: 1;
    }

    .toggle-label-main {
      font-weight: 500;
      color: var(--color-text);
    }

    .toggle-label-sub {
      font-size: 0.875rem;
      color: var(--color-placeholder);
      margin-top: 0.25rem;
    }

    .toggle-switch {
      position: relative;
      width: 48px;
      height: 26px;
      flex-shrink: 0;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--color-border);
      transition: all var(--transition-fast);
      border-radius: 26px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: var(--color-white);
      transition: all var(--transition-fast);
      border-radius: 50%;
      box-shadow: var(--shadow-sm);
    }

    .toggle-switch input:checked + .toggle-slider {
      background-color: var(--color-primary);
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(22px);
    }

    /* Form Sections */
    .form-section {
      margin-bottom: 1.5rem;
    }

    .form-section:last-child {
      margin-bottom: 0;
    }

    .form-section-label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--color-text);
    }

    /* Form Input */
    .form-input {
      width: 100%;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      background-color: var(--color-white);
      color: var(--color-text);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(116, 19, 220, 0.1);
    }

    .form-input:disabled {
      background-color: var(--color-background);
      color: var(--color-placeholder);
      cursor: not-allowed;
    }

    .form-input::placeholder {
      color: var(--color-placeholder);
    }

    /* Radio Group */
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
    }

    .radio-option input[type="radio"] {
      width: 18px;
      height: 18px;
      accent-color: var(--color-primary);
      cursor: pointer;
    }

    .radio-option-label {
      font-size: 0.9375rem;
      color: var(--color-text);
    }

    /* Info Boxes */
    .info-box {
      padding: 1rem;
      background-color: var(--color-info-bg);
      border: 1px solid var(--color-info-border);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      color: #1d4ed8;
      margin-top: 0.75rem;
    }

    .info-box.hidden {
      display: none;
    }

    /* Sync Actions */
    .sync-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .sync-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--color-border);
      border-top-color: var(--color-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    .sync-spinner.hidden {
      display: none;
    }

    /* Last Sync Info */
    #last-sync-info {
      padding: 1rem;
      background-color: var(--color-background);
      border-radius: var(--radius-md);
      margin-top: 1rem;
    }

    .last-sync-time {
      font-weight: 500;
      color: var(--color-text);
    }

    .last-sync-results {
      font-size: 0.875rem;
      color: var(--color-placeholder);
      margin-top: 0.25rem;
    }

    /* Account Info */
    .account-field {
      padding: 1rem 0;
      border-bottom: 1px solid var(--color-border);
    }

    .account-field:last-child {
      border-bottom: none;
    }

    .account-field-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--color-placeholder);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .account-field-value {
      font-size: 1rem;
      color: var(--color-text);
    }

    /* Subscription Card */
    .plan-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background-color: rgba(116, 19, 220, 0.1);
      color: var(--color-primary);
      border-radius: var(--radius-full);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .plan-features {
      margin: 1rem 0;
    }

    .plan-feature {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0;
      font-size: 0.9375rem;
    }

    .plan-feature-check {
      color: var(--color-success);
      font-weight: 700;
    }

    .trial-status {
      padding: 1rem;
      background-color: var(--color-warning-bg);
      border: 1px solid var(--color-warning-border);
      border-radius: var(--radius-md);
      margin-bottom: 1rem;
    }

    .trial-status-text {
      font-weight: 500;
      color: #b45309;
    }

    /* Upgrade Code Section */
    #upgrade-code-section {
      background: linear-gradient(135deg, #F5F3FF 0%, #EDE9FE 100%);
      border: 1px solid #DDD6FE;
    }

    #upgrade-code-section .settings-card-title {
      color: var(--color-primary);
    }

    /* Upgrade Code Form */
    .upgrade-code-form {
      margin-top: 1rem;
    }

    .form-row-inline {
      display: flex;
      gap: 0.75rem;
      align-items: stretch;
    }

    .form-row-inline .form-control {
      flex: 1;
      font-size: 1rem;
      letter-spacing: 0.15em;
      font-weight: 600;
      text-align: center;
      background: var(--color-white);
      border: 2px solid #DDD6FE;
      border-radius: var(--radius-md);
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-row-inline .form-control:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }

    .form-row-inline .form-control::placeholder {
      letter-spacing: normal;
      font-weight: 400;
    }

    .form-row-inline .btn {
      flex-shrink: 0;
      padding-left: 1.5rem;
      padding-right: 1.5rem;
    }

    @media (max-width: 480px) {
      .form-row-inline {
        flex-direction: column;
      }

      .form-row-inline .btn {
        width: 100%;
      }
    }

    .form-error {
      margin-top: 0.75rem;
      padding: 0.75rem 1rem;
      background-color: #FEF2F2;
      border: 1px solid #FECACA;
      border-radius: var(--radius-md);
      color: #DC2626;
      font-size: 0.875rem;
    }

    .form-success {
      margin-top: 0.75rem;
      padding: 0.75rem 1rem;
      background-color: #ECFDF5;
      border: 1px solid #A7F3D0;
      border-radius: var(--radius-md);
      color: #065F46;
      font-size: 0.875rem;
    }

    #upgrade-code-section.hidden {
      display: none;
    }

    /* Team Members */
    .team-member {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background-color: var(--color-background);
      border-radius: var(--radius-md);
      margin-bottom: 0.5rem;
    }

    .team-member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--color-primary);
      color: var(--color-white);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      flex-shrink: 0;
    }

    .team-member-info {
      flex: 1;
    }

    .team-member-name {
      font-weight: 500;
      color: var(--color-text);
    }

    .team-member-email {
      font-size: 0.875rem;
      color: var(--color-placeholder);
    }

    .team-member-role {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--color-placeholder);
      text-transform: uppercase;
    }

    .team-member-role.owner {
      color: var(--color-primary);
    }

    .team-member-role.admin {
      color: var(--color-success);
    }

    .team-member-actions {
      display: flex;
      gap: 0.5rem;
    }

    .team-member-actions .btn-icon {
      padding: 0.375rem;
      border-radius: var(--radius-sm);
      background: transparent;
      border: none;
      cursor: pointer;
      color: var(--color-placeholder);
      transition: all var(--transition-fast);
    }

    .team-member-actions .btn-icon:hover {
      background-color: var(--color-background);
      color: var(--color-text);
    }

    .team-member-actions .btn-icon.danger:hover {
      background-color: var(--color-error-bg);
      color: var(--color-error);
    }

    /* Pending Invitations */
    .pending-invitation {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background-color: var(--color-warning-bg);
      border: 1px dashed var(--color-warning-border);
      border-radius: var(--radius-md);
      margin-bottom: 0.5rem;
    }

    .pending-invitation-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--color-warning-border);
      color: #b45309;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .pending-invitation-info {
      flex: 1;
    }

    .pending-invitation-email {
      font-weight: 500;
      color: var(--color-text);
    }

    .pending-invitation-meta {
      font-size: 0.875rem;
      color: var(--color-placeholder);
    }

    .pending-invitation-status {
      font-size: 0.75rem;
      font-weight: 600;
      color: #b45309;
      text-transform: uppercase;
    }

    /* Invite Modal */
    .invite-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-base);
    }

    .invite-modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .invite-modal {
      background-color: var(--color-white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      width: 100%;
      max-width: 480px;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(20px);
      transition: transform var(--transition-base);
    }

    .invite-modal-overlay.active .invite-modal {
      transform: translateY(0);
    }

    .invite-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid var(--color-border);
    }

    .invite-modal-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0;
    }

    .invite-modal-close {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      color: var(--color-placeholder);
      transition: color var(--transition-fast);
    }

    .invite-modal-close:hover {
      color: var(--color-text);
    }

    .invite-modal-body {
      padding: 1.5rem;
    }

    .invite-modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--color-border);
      background-color: var(--color-background);
    }

    /* Role Select Styles */
    .role-option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 1rem;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      margin-bottom: 0.5rem;
    }

    .role-option:hover {
      border-color: var(--color-primary);
      background-color: var(--color-primary-light);
    }

    .role-option.selected {
      border-color: var(--color-primary);
      background-color: var(--color-primary-light);
    }

    .role-option input[type="radio"] {
      margin-top: 0.25rem;
    }

    .role-option-content {
      flex: 1;
    }

    .role-option-title {
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 0.25rem;
    }

    .role-option-description {
      font-size: 0.875rem;
      color: var(--color-placeholder);
    }

    .feature-locked {
      padding: 1rem;
      background-color: var(--color-background);
      border-radius: var(--radius-md);
      text-align: center;
      color: var(--color-placeholder);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .settings-layout {
        flex-direction: column;
      }

      #settings-sidebar {
        width: 100%;
        max-width: none;
        min-width: auto;
        position: relative;
        top: 0;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--color-border);
        padding: 1rem;
        overflow-x: auto;
      }

      .sidebar-nav {
        flex-direction: row;
        gap: 0.5rem;
        overflow-x: auto;
        padding-bottom: 0.5rem;
      }

      .sidebar-nav-item {
        white-space: nowrap;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }

      .sidebar-nav-item.active {
        font-weight: 700;
      }

      .sidebar-title {
        display: none;
      }

      #settings-content {
        padding: 1rem;
        min-height: auto;
      }

      .panel-header h1 {
        font-size: 1.5rem;
      }

      .settings-card {
        padding: 1rem;
      }

      .toggle-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
      }

      .sync-actions {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* Logout Button Styling */
    .logout-btn {
      background: none;
      border: none;
      color: var(--color-text);
      font-weight: 500;
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      cursor: pointer;
      font-size: 1rem;
    }

    .logout-btn:hover {
      color: var(--color-primary);
      background-color: rgba(116, 19, 220, 0.05);
    }

    /* Availability Schedule Styles */
    .availability-schedule {
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .day-row {
      display: grid;
      grid-template-columns: 120px 1fr auto;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid var(--color-border);
      gap: 1rem;
    }

    .day-row:last-child {
      border-bottom: none;
    }

    .day-row.disabled {
      background-color: var(--color-background);
    }

    .day-row.disabled .day-times {
      opacity: 0.5;
      pointer-events: none;
    }

    .day-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .day-toggle input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--color-primary);
      cursor: pointer;
    }

    .day-name {
      font-weight: 600;
      min-width: 80px;
      cursor: pointer;
    }

    .day-times {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .time-input {
      width: 90px;
      padding: 0.375rem;
      font-size: 0.8125rem;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      background-color: var(--color-white);
      text-align: center;
      color: var(--color-text);
    }

    .time-input:focus {
      outline: none;
      border-color: var(--color-text);
    }

    .time-separator {
      color: var(--color-placeholder);
      font-weight: 500;
    }

    .copy-times-btn {
      font-size: 0.75rem;
      padding: 0.375rem 0.75rem;
      background-color: var(--color-background);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      color: var(--color-text);
      cursor: pointer;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }

    .copy-times-btn:hover {
      background-color: var(--color-border);
    }

    /* Group Sessions */
    .group-sessions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .group-session {
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: 1rem;
      transition: all var(--transition-fast);
    }

    .group-session.disabled {
      background-color: var(--color-background);
    }

    .group-session.disabled .group-schedule {
      opacity: 0.5;
      pointer-events: none;
    }

    .group-row {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .group-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 120px;
    }

    .group-toggle input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--color-primary);
      cursor: pointer;
    }

    .group-name {
      font-weight: 600;
      font-size: 0.9375rem;
      cursor: pointer;
    }

    .group-schedule {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 1;
      justify-content: flex-end;
    }

    .group-day-select .form-select {
      width: 140px;
      height: 38px;
      padding: 0.375rem 2rem 0.375rem 0.5rem;
      font-size: 0.8125rem;
      background-color: var(--color-white);
      color: var(--color-text);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
    }

    .group-day-select .form-select:focus {
      outline: none;
      border-color: var(--color-text);
    }

    .group-time-inputs {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .group-time-inputs .time-input {
      width: 90px;
      height: 38px;
    }

    /* No Hut Message */
    .no-hut-message {
      text-align: center;
      padding: 2rem;
      background-color: var(--color-background);
      border-radius: var(--radius-md);
    }

    .no-hut-message p {
      color: var(--color-placeholder);
      margin-bottom: 1rem;
    }

    /* Save Button Container */
    .save-button-container {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--color-border);
      display: flex;
      justify-content: flex-end;
    }

    @media (max-width: 768px) {
      .day-row {
        display: grid;
        grid-template-columns: 1fr auto;
        grid-template-rows: auto auto;
        gap: 0.5rem;
      }

      .day-toggle {
        grid-column: 1;
        grid-row: 1;
      }

      .copy-times-btn {
        grid-column: 2;
        grid-row: 1;
      }

      .day-times {
        grid-column: 1 / -1;
        grid-row: 2;
        justify-content: flex-start;
        padding-top: 0.5rem;
        border-top: 1px solid var(--color-border);
      }

      .group-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .group-schedule {
        width: 100%;
        flex-direction: row;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: nowrap;
      }

      .group-day-select .form-select {
        width: auto;
        min-width: 100px;
        flex-shrink: 0;
      }

      .group-time-inputs {
        flex: 1;
        justify-content: flex-end;
      }

      .group-time-inputs .time-input {
        width: 75px;
        min-width: 0;
        max-width: 100%;
        box-sizing: border-box;
      }

      /* Prevent time inputs from overflowing */
      .time-input,
      input[type="time"] {
        min-width: 0;
        max-width: 100%;
        box-sizing: border-box;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation (injected by navigation.js) -->
  <div id="dashboard-nav"></div>

  <!-- Main Settings Layout -->
  <div class="settings-layout">
    <!-- Left Sidebar -->
    <aside id="settings-sidebar">
      <div class="sidebar-title">Settings</div>
      <nav class="sidebar-nav">
        <button class="sidebar-nav-item active" id="nav-profile" data-panel="panel-profile">Profile</button>
        <button class="sidebar-nav-item" id="nav-calendar" data-panel="panel-calendar">Calendar Sync</button>
        <button class="sidebar-nav-item" id="nav-availability" data-panel="panel-availability">Hut Availability</button>
        <button class="sidebar-nav-item" id="nav-sessions" data-panel="panel-sessions">Weekly Sessions</button>
        <button class="sidebar-nav-item" id="nav-subscription" data-panel="panel-subscription">Subscription</button>
        <button class="sidebar-nav-item" id="nav-team" data-panel="panel-team">Team</button>
        <button class="sidebar-nav-item" id="nav-notifications" data-panel="panel-notifications">Notifications</button>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main id="settings-content">
      <!-- Profile Panel -->
      <section class="settings-panel active" id="panel-profile">
        <div class="panel-header">
          <h1>My Profile</h1>
          <p>Manage your personal information and account details</p>
        </div>

        <div class="settings-card">
          <div class="settings-card-header">
            <h2 class="settings-card-title">Personal Information</h2>
          </div>
          
          <form id="profile-form">
            <div class="form-section">
              <label class="form-section-label" for="profile-first-name">First Name</label>
              <input type="text" class="form-input" id="profile-first-name" placeholder="Enter your first name">
            </div>

            <div class="form-section">
              <label class="form-section-label" for="profile-last-name">Last Name</label>
              <input type="text" class="form-input" id="profile-last-name" placeholder="Enter your last name">
            </div>

            <div class="form-section">
              <label class="form-section-label" for="profile-email">Email Address</label>
              <input type="email" class="form-input" id="profile-email" disabled>
              <p class="help-text">Email cannot be changed. Contact support if you need to update it.</p>
            </div>

            <div class="form-section">
              <label class="form-section-label" for="profile-phone">Phone Number</label>
              <input type="tel" class="form-input" id="profile-phone" placeholder="Enter your phone number">
            </div>

            <div class="form-section">
              <label class="form-section-label" for="profile-organisation">Organisation / Scout Group</label>
              <input type="text" class="form-input" id="profile-organisation" placeholder="e.g. 1st Anytown Scouts">
            </div>

            <div class="save-button-container">
              <button type="submit" class="btn btn-primary" id="save-profile-btn">Save Profile</button>
            </div>
          </form>
        </div>

        <div class="settings-card">
          <div class="settings-card-header">
            <h2 class="settings-card-title">Account Details</h2>
          </div>
          
          <div class="account-field">
            <div class="account-field-label">Account Created</div>
            <div class="account-field-value" id="account-created">Loading...</div>
          </div>
          <div class="account-field">
            <div class="account-field-label">Last Sign In</div>
            <div class="account-field-value" id="last-sign-in">Loading...</div>
          </div>
        </div>

        <div class="settings-card">
          <div class="settings-card-header">
            <h2 class="settings-card-title">Danger Zone</h2>
          </div>
          <p class="settings-card-subtitle" style="margin-bottom: 1rem;">Permanent actions that cannot be undone.</p>
          <button class="btn btn-secondary" id="delete-account-btn" style="color: var(--color-error); border-color: var(--color-error);">Delete Account</button>
          <p class="help-text">This will permanently delete your account and all associated data.</p>
        </div>
      </section>

      <!-- Calendar Sync Panel -->
      <section class="settings-panel" id="panel-calendar">
        <div class="panel-header">
          <h1>Google Calendar Sync</h1>
          <p>Connect and sync your bookings with Google Calendar</p>
        </div>

        <!-- Connection Status -->
        <div class="settings-card">
          <div class="settings-card-header">
            <div>
              <h2 class="settings-card-title">Connection Status</h2>
            </div>
          </div>
          
          <div class="connection-status" id="connection-status">
            <div class="status-indicator disconnected" id="status-indicator"></div>
            <div class="status-text">
              <div class="status-text-main" id="status-text-main">Not connected</div>
              <div class="status-text-sub" id="status-text-sub">Connect your Google account to enable sync</div>
            </div>
          </div>

          <!-- Not Connected State -->
          <div id="not-connected-state">
            <button class="btn btn-primary" id="connect-calendar-btn">Connect Google Calendar</button>
            <p class="help-text">Connect your Google account to enable calendar synchronization</p>
          </div>

          <!-- Connected State -->
          <div id="connected-state" style="display: none;">
            <button class="btn btn-secondary" id="disconnect-calendar-btn">Disconnect</button>
          </div>
        </div>

        <!-- Sync Configuration (shown when connected) -->
        <div class="settings-card" id="sync-config-card" style="display: none;">
          <div class="settings-card-header">
            <h2 class="settings-card-title">Sync Settings</h2>
          </div>

          <!-- Sync Toggle -->
          <div class="toggle-row">
            <div class="toggle-label">
              <div class="toggle-label-main">Enable Calendar Sync</div>
              <div class="toggle-label-sub">Automatically sync bookings with your Google Calendar</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="sync-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- Sync Configuration Options -->
          <div id="sync-options" style="display: none;">
            <!-- Calendar Selection -->
            <div class="form-section">
              <label class="form-section-label" for="calendar-select">Select calendar:</label>
              <select class="form-select" id="calendar-select">
                <option value="">Loading calendars...</option>
              </select>
              <p class="help-text">Choose which Google Calendar to sync with</p>
            </div>

            <!-- Sync Direction -->
            <div class="form-section">
              <label class="form-section-label">Sync direction:</label>
              <div class="radio-group">
                <label class="radio-option">
                  <input type="radio" name="sync-direction" value="both" checked>
                  <span class="radio-option-label">Two-way sync (recommended)</span>
                </label>
                <label class="radio-option">
                  <input type="radio" name="sync-direction" value="from_google">
                  <span class="radio-option-label">Import from Google only</span>
                </label>
                <label class="radio-option">
                  <input type="radio" name="sync-direction" value="to_google">
                  <span class="radio-option-label">Export to Google only</span>
                </label>
              </div>
            </div>

            <!-- Direction Info Boxes -->
            <div class="info-box" id="info-import">
              Events from your Google Calendar will block booking times
            </div>
            <div class="info-box" id="info-export">
              Scout Bookings will be added to your Google Calendar
            </div>

            <!-- Manual Sync -->
            <div class="sync-actions">
              <button class="btn btn-secondary" id="sync-now-btn">Sync Now</button>
              <div class="sync-spinner hidden" id="sync-spinner"></div>
            </div>

            <!-- Last Sync Info -->
            <div id="last-sync-info">
              <div class="last-sync-time" id="last-sync-time">Never synced</div>
              <div class="last-sync-results" id="last-sync-results"></div>
            </div>
          </div>
        </div>

      </section>

      <!-- Hut Availability Panel -->
      <section class="settings-panel" id="panel-availability">
        <div class="panel-header">
          <h1>Hut Availability</h1>
          <p>Set the days and hours when your hut is available for bookings</p>
        </div>

        <!-- No Hut State -->
        <div class="settings-card" id="availability-no-hut" style="display: none;">
          <div class="no-hut-message">
            <p>You need to create a scout hut before setting availability.</p>
            <a href="edit-hut.html" class="btn btn-primary">Create Your Hut</a>
          </div>
        </div>

        <!-- Availability Settings -->
        <div class="settings-card" id="availability-settings" style="display: none;">
          <div class="settings-card-header">
            <h2 class="settings-card-title">Weekly Schedule</h2>
          </div>
          <p class="settings-card-subtitle" style="margin-bottom: 1rem;">Set when your hut is available for external bookings each week.</p>

          <!-- Availability Schedule -->
          <div class="availability-schedule" id="availability-schedule">
            <!-- Monday -->
            <div class="day-row" data-day="monday">
              <div class="day-toggle">
                <input type="checkbox" id="monday-enabled">
                <label for="monday-enabled" class="day-name">Monday</label>
              </div>
              <div class="day-times">
                <input type="time" class="time-input start-time" value="09:00" min="00:00" max="23:59" aria-label="Monday start time">
                <span class="time-separator">to</span>
                <input type="time" class="time-input end-time" value="21:00" min="00:00" max="23:59" aria-label="Monday end time">
              </div>
              <button type="button" class="copy-times-btn" onclick="copyTimesToAll('monday')">Copy to all</button>
            </div>

            <!-- Tuesday -->
            <div class="day-row" data-day="tuesday">
              <div class="day-toggle">
                <input type="checkbox" id="tuesday-enabled">
                <label for="tuesday-enabled" class="day-name">Tuesday</label>
              </div>
              <div class="day-times">
                <input type="time" class="time-input start-time" value="09:00" min="00:00" max="23:59" aria-label="Tuesday start time">
                <span class="time-separator">to</span>
                <input type="time" class="time-input end-time" value="21:00" min="00:00" max="23:59" aria-label="Tuesday end time">
              </div>
              <button type="button" class="copy-times-btn" onclick="copyTimesToAll('tuesday')">Copy to all</button>
            </div>

            <!-- Wednesday -->
            <div class="day-row" data-day="wednesday">
              <div class="day-toggle">
                <input type="checkbox" id="wednesday-enabled">
                <label for="wednesday-enabled" class="day-name">Wednesday</label>
              </div>
              <div class="day-times">
                <input type="time" class="time-input start-time" value="09:00" min="00:00" max="23:59" aria-label="Wednesday start time">
                <span class="time-separator">to</span>
                <input type="time" class="time-input end-time" value="21:00" min="00:00" max="23:59" aria-label="Wednesday end time">
              </div>
              <button type="button" class="copy-times-btn" onclick="copyTimesToAll('wednesday')">Copy to all</button>
            </div>

            <!-- Thursday -->
            <div class="day-row" data-day="thursday">
              <div class="day-toggle">
                <input type="checkbox" id="thursday-enabled">
                <label for="thursday-enabled" class="day-name">Thursday</label>
              </div>
              <div class="day-times">
                <input type="time" class="time-input start-time" value="09:00" min="00:00" max="23:59" aria-label="Thursday start time">
                <span class="time-separator">to</span>
                <input type="time" class="time-input end-time" value="21:00" min="00:00" max="23:59" aria-label="Thursday end time">
              </div>
              <button type="button" class="copy-times-btn" onclick="copyTimesToAll('thursday')">Copy to all</button>
            </div>

            <!-- Friday -->
            <div class="day-row" data-day="friday">
              <div class="day-toggle">
                <input type="checkbox" id="friday-enabled">
                <label for="friday-enabled" class="day-name">Friday</label>
              </div>
              <div class="day-times">
                <input type="time" class="time-input start-time" value="09:00" min="00:00" max="23:59" aria-label="Friday start time">
                <span class="time-separator">to</span>
                <input type="time" class="time-input end-time" value="21:00" min="00:00" max="23:59" aria-label="Friday end time">
              </div>
              <button type="button" class="copy-times-btn" onclick="copyTimesToAll('friday')">Copy to all</button>
            </div>

            <!-- Saturday -->
            <div class="day-row" data-day="saturday">
              <div class="day-toggle">
                <input type="checkbox" id="saturday-enabled">
                <label for="saturday-enabled" class="day-name">Saturday</label>
              </div>
              <div class="day-times">
                <input type="time" class="time-input start-time" value="09:00" min="00:00" max="23:59" aria-label="Saturday start time">
                <span class="time-separator">to</span>
                <input type="time" class="time-input end-time" value="21:00" min="00:00" max="23:59" aria-label="Saturday end time">
              </div>
              <button type="button" class="copy-times-btn" onclick="copyTimesToAll('saturday')">Copy to all</button>
            </div>

            <!-- Sunday -->
            <div class="day-row" data-day="sunday">
              <div class="day-toggle">
                <input type="checkbox" id="sunday-enabled">
                <label for="sunday-enabled" class="day-name">Sunday</label>
              </div>
              <div class="day-times">
                <input type="time" class="time-input start-time" value="09:00" min="00:00" max="23:59" aria-label="Sunday start time">
                <span class="time-separator">to</span>
                <input type="time" class="time-input end-time" value="21:00" min="00:00" max="23:59" aria-label="Sunday end time">
              </div>
              <button type="button" class="copy-times-btn" onclick="copyTimesToAll('sunday')">Copy to all</button>
            </div>
          </div>

          <!-- Save Button -->
          <div class="save-button-container">
            <button type="button" class="btn btn-primary" id="save-availability-btn" onclick="saveAvailability()">Save Availability</button>
          </div>
        </div>
      </section>

      <!-- Weekly Sessions Panel -->
      <section class="settings-panel" id="panel-sessions">
        <div class="panel-header">
          <h1>Weekly Group Sessions</h1>
          <p>Set regular weekly times for your scout groups</p>
        </div>

        <!-- No Hut State -->
        <div class="settings-card" id="sessions-no-hut" style="display: none;">
          <div class="no-hut-message">
            <p>You need to create a scout hut before setting weekly sessions.</p>
            <a href="edit-hut.html" class="btn btn-primary">Create Your Hut</a>
          </div>
        </div>

        <!-- Sessions Settings -->
        <div class="settings-card" id="sessions-settings" style="display: none;">
          <div class="settings-card-header">
            <h2 class="settings-card-title">Scout Group Sessions</h2>
          </div>
          <p class="settings-card-subtitle" style="margin-bottom: 1rem;">These times will be blocked out on the calendar but won't appear as individual bookings.</p>

          <div class="group-sessions">
            <!-- Squirrels -->
            <div class="group-session" data-group="squirrels">
              <div class="group-row">
                <div class="group-toggle">
                  <input type="checkbox" id="squirrels-enabled">
                  <label for="squirrels-enabled" class="group-name">Squirrels</label>
                </div>
                <div class="group-schedule" id="squirrels-schedule">
                  <div class="group-day-select">
                    <select class="form-select group-day" id="squirrels-day">
                      <option value="">Select day...</option>
                      <option value="monday">Monday</option>
                      <option value="tuesday">Tuesday</option>
                      <option value="wednesday">Wednesday</option>
                      <option value="thursday">Thursday</option>
                      <option value="friday">Friday</option>
                      <option value="saturday">Saturday</option>
                      <option value="sunday">Sunday</option>
                    </select>
                  </div>
                  <div class="group-times">
                    <div class="group-time-inputs">
                      <input type="time" class="time-input" id="squirrels-start" value="16:00" min="00:00" max="23:59">
                      <span class="time-separator">to</span>
                      <input type="time" class="time-input" id="squirrels-end" value="17:00" min="00:00" max="23:59">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Beavers -->
            <div class="group-session" data-group="beavers">
              <div class="group-row">
                <div class="group-toggle">
                  <input type="checkbox" id="beavers-enabled">
                  <label for="beavers-enabled" class="group-name">Beavers</label>
                </div>
                <div class="group-schedule" id="beavers-schedule">
                  <div class="group-day-select">
                    <select class="form-select group-day" id="beavers-day">
                      <option value="">Select day...</option>
                      <option value="monday">Monday</option>
                      <option value="tuesday">Tuesday</option>
                      <option value="wednesday">Wednesday</option>
                      <option value="thursday">Thursday</option>
                      <option value="friday">Friday</option>
                      <option value="saturday">Saturday</option>
                      <option value="sunday">Sunday</option>
                    </select>
                  </div>
                  <div class="group-times">
                    <div class="group-time-inputs">
                      <input type="time" class="time-input" id="beavers-start" value="17:30" min="00:00" max="23:59">
                      <span class="time-separator">to</span>
                      <input type="time" class="time-input" id="beavers-end" value="18:30" min="00:00" max="23:59">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Cubs -->
            <div class="group-session" data-group="cubs">
              <div class="group-row">
                <div class="group-toggle">
                  <input type="checkbox" id="cubs-enabled">
                  <label for="cubs-enabled" class="group-name">Cubs</label>
                </div>
                <div class="group-schedule" id="cubs-schedule">
                  <div class="group-day-select">
                    <select class="form-select group-day" id="cubs-day">
                      <option value="">Select day...</option>
                      <option value="monday">Monday</option>
                      <option value="tuesday">Tuesday</option>
                      <option value="wednesday">Wednesday</option>
                      <option value="thursday">Thursday</option>
                      <option value="friday">Friday</option>
                      <option value="saturday">Saturday</option>
                      <option value="sunday">Sunday</option>
                    </select>
                  </div>
                  <div class="group-times">
                    <div class="group-time-inputs">
                      <input type="time" class="time-input" id="cubs-start" value="18:30" min="00:00" max="23:59">
                      <span class="time-separator">to</span>
                      <input type="time" class="time-input" id="cubs-end" value="20:00" min="00:00" max="23:59">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Scouts -->
            <div class="group-session" data-group="scouts">
              <div class="group-row">
                <div class="group-toggle">
                  <input type="checkbox" id="scouts-enabled">
                  <label for="scouts-enabled" class="group-name">Scouts</label>
                </div>
                <div class="group-schedule" id="scouts-schedule">
                  <div class="group-day-select">
                    <select class="form-select group-day" id="scouts-day">
                      <option value="">Select day...</option>
                      <option value="monday">Monday</option>
                      <option value="tuesday">Tuesday</option>
                      <option value="wednesday">Wednesday</option>
                      <option value="thursday">Thursday</option>
                      <option value="friday">Friday</option>
                      <option value="saturday">Saturday</option>
                      <option value="sunday">Sunday</option>
                    </select>
                  </div>
                  <div class="group-times">
                    <div class="group-time-inputs">
                      <input type="time" class="time-input" id="scouts-start" value="19:00" min="00:00" max="23:59">
                      <span class="time-separator">to</span>
                      <input type="time" class="time-input" id="scouts-end" value="21:00" min="00:00" max="23:59">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Save Button -->
          <div class="save-button-container">
            <button type="button" class="btn btn-primary" id="save-sessions-btn" onclick="saveWeeklySessions()">Save Sessions</button>
          </div>
        </div>
      </section>


      <!-- Subscription Panel -->
      <section class="settings-panel" id="panel-subscription">
        <div class="panel-header">
          <h1>Subscription</h1>
          <p>Manage your subscription and billing</p>
        </div>

        <!-- Trial Status -->
        <div class="trial-status" id="trial-status" style="display: none;">
          <div class="trial-status-text" id="trial-status-text">Your trial ends in X days</div>
        </div>

        <div class="settings-card">
          <div class="settings-card-header">
            <div>
              <h2 class="settings-card-title">Current Plan</h2>
            </div>
            <span class="plan-badge" id="user-plan">Free</span>
          </div>

          <div class="plan-features">
            <div class="plan-feature">
              <span class="plan-feature-check">Y</span>
              <span>Unlimited bookings</span>
            </div>
            <div class="plan-feature">
              <span class="plan-feature-check">Y</span>
              <span>Calendar view</span>
            </div>
            <div class="plan-feature">
              <span class="plan-feature-check">Y</span>
              <span>Weekly sessions</span>
            </div>
            <div class="plan-feature" id="feature-calendar-sync">
              <span class="plan-feature-check">Y</span>
              <span>Google Calendar sync</span>
            </div>
            <div class="plan-feature" id="feature-team">
              <span class="plan-feature-check">Y</span>
              <span>Team members</span>
            </div>
          </div>

          <div class="account-field">
            <div class="account-field-label">Renewal Date</div>
            <div class="account-field-value" id="renewal-date">N/A</div>
          </div>
        </div>

        <!-- Upgrade Code Section -->
        <div class="settings-card" id="upgrade-code-section">
          <div class="settings-card-header">
            <div style="display: flex; align-items: center; gap: 0.75rem;">
              <div style="width: 40px; height: 40px; background: var(--color-primary); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                </svg>
              </div>
              <div>
                <h2 class="settings-card-title">Have an Upgrade Code?</h2>
                <p class="settings-card-subtitle">Enter your code below to unlock Pro features</p>
              </div>
            </div>
          </div>
          
          <form id="upgrade-code-form" class="upgrade-code-form">
            <div class="form-row-inline">
              <input 
                type="text" 
                id="upgrade-code-input" 
                class="form-control" 
                placeholder=""
                autocomplete="off"
                spellcheck="false"
                style="text-transform: uppercase;"
              >
              <button type="submit" class="btn btn-primary" id="redeem-code-btn">Redeem</button>
            </div>
            <div id="upgrade-code-error" class="form-error" style="display: none;"></div>
            <div id="upgrade-code-success" class="form-success" style="display: none;"></div>
          </form>
        </div>
      </section>

      <!-- Team Panel -->
      <section class="settings-panel" id="panel-team">
        <div class="panel-header">
          <h1>Team Members</h1>
          <p>Manage who has access to your Scout Bookings</p>
        </div>

        <div class="settings-card">
          <div class="settings-card-header">
            <h2 class="settings-card-title">Your Team</h2>
          </div>

          <div id="team-members-list">
            <!-- Team members will be loaded here -->
          </div>

          <div class="feature-locked" id="team-feature-locked">
            Team features available on Pro plan
          </div>
        </div>

        <div class="settings-card">
          <button class="btn btn-secondary" disabled>Invite Team Member</button>
          <p class="help-text">Team invitations coming soon</p>
        </div>
      </section>

      <!-- Notifications Panel -->
      <section class="settings-panel" id="panel-notifications">
        <div class="panel-header">
          <h1>Notification Preferences</h1>
          <p>Control how and when you receive notifications</p>
        </div>

        <div class="settings-card">
          <div class="settings-card-header">
            <h2 class="settings-card-title">Email Notifications</h2>
          </div>

          <div class="toggle-row">
            <div class="toggle-label">
              <div class="toggle-label-main">Booking confirmations</div>
              <div class="toggle-label-sub">Receive email when a booking is created</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="notify-booking-created" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="toggle-row">
            <div class="toggle-label">
              <div class="toggle-label-main">Booking reminders</div>
              <div class="toggle-label-sub">Get reminded about upcoming bookings</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="notify-booking-reminder" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="toggle-row">
            <div class="toggle-label">
              <div class="toggle-label-main">Cancellation alerts</div>
              <div class="toggle-label-sub">Be notified when a booking is cancelled</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="notify-booking-cancelled" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-card">
          <div class="settings-card-header">
            <h2 class="settings-card-title">SMS Notifications</h2>
          </div>

          <div class="feature-locked">
            SMS notifications coming soon
          </div>
        </div>

        <div class="settings-card">
          <div class="settings-card-header">
            <h2 class="settings-card-title">Notification Frequency</h2>
          </div>

          <div class="form-section">
            <label class="form-section-label">Reminder timing:</label>
            <select class="form-select" id="reminder-timing">
              <option value="1">1 day before</option>
              <option value="2" selected>2 days before</option>
              <option value="7">1 week before</option>
            </select>
          </div>

          <div class="feature-locked" style="margin-top: 1rem;">
            Advanced notification settings available on Pro plan
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p class="text-center text-muted">2026 Scout Bookings. All rights reserved.</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../js/config.js"></script>
  <script src="../js/utils.js"></script>
  <script src="../js/navigation.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/calendar.js"></script>
  <script src="../js/settings.js"></script>
  <script>
    // Initialize navigation
    initDashboardNavigation();
    // Settings page initialization
    // Note: Main initialization is handled by settings.js via its own DOMContentLoaded
    // This inline script only provides fallback functions if needed
    document.addEventListener('DOMContentLoaded', async function() {
      // settings.js handles auth check and full initialization
      // Only run fallback UI setup if settings.js didn't initialize
      // (check after a small delay to allow settings.js to run first)
      setTimeout(() => {
        // If settings.js already set up event listeners, don't duplicate
        if (window.SettingsModule) {
          console.log('[Settings HTML] settings.js module loaded, skipping inline init');
          return;
        }
        
        // Fallback initialization only if settings.js failed to load
        console.log('[Settings HTML] Running fallback initialization');
        checkAuth().then(user => {
          if (!user) {
            window.location.href = 'login.html';
            return;
          }
          initSidebarNav();
          loadAccountInfo(user);
          loadSubscriptionInfo(user);
          loadTeamInfo(user);
          initCalendarSyncUI(user);
        });
      }, 100);
    });

    // Sidebar Navigation
    function initSidebarNav() {
      const navItems = document.querySelectorAll('.sidebar-nav-item');
      const panels = document.querySelectorAll('.settings-panel');
      const menuToggle = document.getElementById('settings-menu-toggle');
      const sidebarNav = document.getElementById('sidebar-nav');
      const currentSectionLabel = document.getElementById('current-section-label');

      // Mobile menu toggle
      if (menuToggle) {
        menuToggle.addEventListener('click', () => {
          const isOpen = sidebarNav.classList.toggle('open');
          menuToggle.classList.toggle('active', isOpen);
          menuToggle.setAttribute('aria-expanded', isOpen);
        });
      }

      navItems.forEach(item => {
        item.addEventListener('click', () => {
          // Update active nav item
          navItems.forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');

          // Show corresponding panel
          const panelId = item.dataset.panel;
          panels.forEach(panel => {
            panel.classList.remove('active');
            if (panel.id === panelId) {
              panel.classList.add('active');
            }
          });

          // Update mobile menu label and close menu
          if (currentSectionLabel) {
            currentSectionLabel.textContent = item.textContent;
          }
          if (sidebarNav && window.innerWidth <= 768) {
            sidebarNav.classList.remove('open');
            if (menuToggle) {
              menuToggle.classList.remove('active');
              menuToggle.setAttribute('aria-expanded', 'false');
            }
          }
        });
      });

      // Check URL hash for direct panel navigation
      const hash = window.location.hash.replace('#', '');
      if (hash) {
        const targetNav = document.querySelector(`[data-panel="panel-${hash}"]`);
        if (targetNav) {
          targetNav.click();
        }
      }
    }

    // Load Profile Information
    function loadAccountInfo(user) {
      // Profile form fields
      const firstNameEl = document.getElementById('profile-first-name');
      const lastNameEl = document.getElementById('profile-last-name');
      const emailEl = document.getElementById('profile-email');
      const phoneEl = document.getElementById('profile-phone');
      const organisationEl = document.getElementById('profile-organisation');
      const createdEl = document.getElementById('account-created');
      const lastSignInEl = document.getElementById('last-sign-in');

      // Parse full name into first/last
      const fullName = user.user_metadata?.full_name || user.user_metadata?.name || '';
      const nameParts = fullName.split(' ');
      const firstName = nameParts[0] || '';
      const lastName = nameParts.slice(1).join(' ') || '';

      if (firstNameEl) firstNameEl.value = user.user_metadata?.first_name || firstName;
      if (lastNameEl) lastNameEl.value = user.user_metadata?.last_name || lastName;
      if (emailEl) emailEl.value = user.email || '';
      if (phoneEl) phoneEl.value = user.user_metadata?.phone || user.phone || '';
      if (organisationEl) organisationEl.value = user.user_metadata?.organisation || '';

      if (createdEl) {
        const created = new Date(user.created_at);
        createdEl.textContent = created.toLocaleDateString('en-GB', {
          day: 'numeric',
          month: 'long',
          year: 'numeric'
        });
      }

      if (lastSignInEl) {
        const lastSignIn = user.last_sign_in_at ? new Date(user.last_sign_in_at) : null;
        lastSignInEl.textContent = lastSignIn 
          ? lastSignIn.toLocaleDateString('en-GB', {
              day: 'numeric',
              month: 'long',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            })
          : 'Never';
      }

      // Set up profile form submission
      const profileForm = document.getElementById('profile-form');
      if (profileForm) {
        profileForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          await saveProfile(user);
        });
      }

      // Set up delete account button
      const deleteBtn = document.getElementById('delete-account-btn');
      if (deleteBtn) {
        deleteBtn.addEventListener('click', () => {
          if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
            showNotification('Account deletion is not yet implemented. Please contact support.', 'info');
          }
        });
      }
    }

    // Save profile information
    async function saveProfile(user) {
      const saveBtn = document.getElementById('save-profile-btn');
      const originalText = saveBtn.textContent;
      saveBtn.textContent = 'Saving...';
      saveBtn.disabled = true;

      try {
        const firstName = document.getElementById('profile-first-name').value.trim();
        const lastName = document.getElementById('profile-last-name').value.trim();
        const phone = document.getElementById('profile-phone').value.trim();
        const organisation = document.getElementById('profile-organisation').value.trim();

        const { error } = await supabaseClient.auth.updateUser({
          data: {
            first_name: firstName,
            last_name: lastName,
            full_name: `${firstName} ${lastName}`.trim(),
            phone: phone,
            organisation: organisation
          }
        });

        if (error) throw error;

        showNotification('Profile updated successfully', 'success');
      } catch (err) {
        console.error('Error saving profile:', err);
        showNotification('Failed to save profile', 'error');
      } finally {
        saveBtn.textContent = originalText;
        saveBtn.disabled = false;
      }
    }

    // Load Subscription Information
    async function loadSubscriptionInfo(user) {
      try {
        const { data: profile, error } = await supabaseClient
          .from('user_profiles')
          .select('subscription_status, subscription_plan')
          .eq('id', user.id)
          .single();

        if (error) {
          console.error('Error loading subscription:', error);
          return;
        }

        const planBadge = document.getElementById('user-plan');
        const trialStatus = document.getElementById('trial-status');
        const trialStatusText = document.getElementById('trial-status-text');

        if (profile) {
          // Set plan badge
          if (planBadge) {
            const status = profile.subscription_status || 'trial';
            planBadge.textContent = status.charAt(0).toUpperCase() + status.slice(1);
          }

          // Hide trial status (trials disabled)
          if (trialStatus) {
            trialStatus.style.display = 'none';
          }
        }
      } catch (err) {
        console.error('Error loading subscription info:', err);
      }
    }

    // Load Team Information - now handled by settings.js loadTeamPanel()
    async function loadTeamInfo(user) {
      // Team functionality is now handled by settings.js
      // This function is kept for backwards compatibility but does nothing
      console.log('[Settings] loadTeamInfo called - delegating to settings.js');
    }

    // Initialize Calendar Sync UI (fallback if settings.js doesn't provide it)
    function initCalendarSyncUI(user) {
      const connectBtn = document.getElementById('connect-calendar-btn');
      const disconnectBtn = document.getElementById('disconnect-calendar-btn');
      const syncToggle = document.getElementById('sync-toggle');
      const syncNowBtn = document.getElementById('sync-now-btn');

      // Connect and Disconnect buttons are handled by settings.js setupEventListeners
      // No need to add listeners here as settings.js already handles them

      // Sync toggle
      if (syncToggle) {
        syncToggle.addEventListener('change', () => {
          const syncOptions = document.getElementById('sync-options');
          if (syncOptions) {
            syncOptions.style.display = syncToggle.checked ? 'block' : 'none';
          }
        });
      }

      // Sync direction radio buttons
      const syncDirectionRadios = document.querySelectorAll('input[name="sync-direction"]');
      syncDirectionRadios.forEach(radio => {
        radio.addEventListener('change', updateDirectionInfoBoxes);
      });

      // Sync now button
      if (syncNowBtn) {
        syncNowBtn.addEventListener('click', async () => {
          const spinner = document.getElementById('sync-spinner');
          if (spinner) spinner.classList.remove('hidden');
          syncNowBtn.disabled = true;

          try {
            if (typeof syncCalendarNow === 'function') {
              await syncCalendarNow();
            }
            updateLastSyncInfo();
          } catch (err) {
            console.error('Sync error:', err);
            showNotification('Sync failed', 'error');
          } finally {
            if (spinner) spinner.classList.add('hidden');
            syncNowBtn.disabled = false;
          }
        });
      }

      // Check current connection status
      checkCalendarConnection(user);
    }

    // Check calendar connection status
    async function checkCalendarConnection(user) {
      try {
        if (typeof getCalendarConnectionStatus === 'function') {
          const status = await getCalendarConnectionStatus(user.id);
          updateConnectionUI(status.connected, status.email);
        }
      } catch (err) {
        console.error('Error checking calendar connection:', err);
      }
    }

    // Update connection UI
    function updateConnectionUI(connected, email = '') {
      const indicator = document.getElementById('status-indicator');
      const mainText = document.getElementById('status-text-main');
      const subText = document.getElementById('status-text-sub');
      const notConnectedState = document.getElementById('not-connected-state');
      const connectedState = document.getElementById('connected-state');
      const syncConfigCard = document.getElementById('sync-config-card');

      if (connected) {
        if (indicator) {
          indicator.classList.remove('disconnected');
          indicator.classList.add('connected');
        }
        if (mainText) mainText.textContent = `Connected as ${email}`;
        if (subText) subText.textContent = 'Your Google Calendar is linked';
        if (notConnectedState) notConnectedState.style.display = 'none';
        if (connectedState) connectedState.style.display = 'block';
        if (syncConfigCard) syncConfigCard.style.display = 'block';
      } else {
        if (indicator) {
          indicator.classList.remove('connected');
          indicator.classList.add('disconnected');
        }
        if (mainText) mainText.textContent = 'Not connected';
        if (subText) subText.textContent = 'Connect your Google account to enable sync';
        if (notConnectedState) notConnectedState.style.display = 'block';
        if (connectedState) connectedState.style.display = 'none';
        if (syncConfigCard) syncConfigCard.style.display = 'none';
      }
    }

    // Update direction info boxes based on selection
    function updateDirectionInfoBoxes() {
      const direction = document.querySelector('input[name="sync-direction"]:checked')?.value;
      const importBox = document.getElementById('info-import');
      const exportBox = document.getElementById('info-export');

      if (importBox) {
        importBox.classList.toggle('hidden', direction === 'to_google');
      }
      if (exportBox) {
        exportBox.classList.toggle('hidden', direction === 'from_google');
      }
    }

    // Update last sync info
    function updateLastSyncInfo() {
      const timeEl = document.getElementById('last-sync-time');
      const resultsEl = document.getElementById('last-sync-results');

      if (timeEl) {
        timeEl.textContent = `Last synced: ${new Date().toLocaleString('en-GB')}`;
      }
      if (resultsEl) {
        resultsEl.textContent = 'Sync completed successfully';
      }
    }


    // Initialize direction info boxes on load
    updateDirectionInfoBoxes();
  </script>
</body>
</html>
